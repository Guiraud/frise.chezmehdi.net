<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Bétharram - ApexCharts</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.0/dist/apexcharts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background-color: #008FFB;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0066CC;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #545b62;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        .info-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #008FFB;
        }
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Chronologie de l'Affaire Bétharram</h1>
        <p>Timeline interactive avec ApexCharts - Événements de 1995 à 2001</p>
    </div>

    <div class="controls">
        <button class="btn btn-primary" onclick="showEvents()">Événements</button>
        <button class="btn btn-primary" onclick="showPeriods()">Périodes</button>
        <button class="btn btn-primary" onclick="showCombined()">Vue Combinée</button>
        <button class="btn btn-secondary" onclick="exportChart()">Exporter PNG</button>
        <button class="btn btn-secondary" onclick="exportSVG()">Exporter SVG</button>
    </div>

    <div class="chart-container">
        <div id="timeline-chart"></div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #008FFB;"></div>
            <span>Événements ponctuels</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #FF5722;"></div>
            <span>Couverture médiatique</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #795548;"></div>
            <span>Procédures judiciaires</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #4CAF50;"></div>
            <span>Contrôle judiciaire</span>
        </div>
    </div>

    <div class="info-panel">
        <h3>Statistiques de la Timeline</h3>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="event-count">26</div>
                <div class="stat-label">Événements</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="period-count">6</div>
                <div class="stat-label">Périodes</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="duration">6</div>
                <div class="stat-label">Années de couverture</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="peak-year">1996</div>
                <div class="stat-label">Année la plus dense</div>
            </div>
        </div>
    </div>

    <script>
        // Données importées du JSON
        const timelineData = {
            "repuPyreneesEvents": [
                {
                    "description": "La gifle de janvier 1995 qui a fait perdre définitivement 40% de ses capacités auditives à l'élève (fait rapporté en 1996)",
                    "title": "La gifle fatale",
                    "date": "1995-01-31 12:00:00"
                },
                {
                    "description": "Le péron",
                    "title": "Le péron provoqué par un encadrant-élève",
                    "date": "1995-12-05 21:00:00"
                },
                {
                    "description": "Le 2 avril 1996, vers 15 heures, un élève de 3ème [texte masqué] est sorti en courant d'une salle de cours (pendant l'intercours) et a sauté sur un de ses camarades en s'appuyant sur son épaule. En retombant, son coude a heurté Madame [texte masqué], professeur, qui passait près d'eux (voir document en annexes).",
                    "title": "Violence sur la professeure de mathématique",
                    "date": "1995-04-02 10:00:00"
                },
                {
                    "description": "Dépôt d'une plainte par le père d'un élève pensionnaire pour violences volontaires et traitements inhumains et dégradants à Bétharram",
                    "title": "Plainte pour violences",
                    "date": "1996-01-29 12:00:00"
                },
                {
                    "description": "Publication en Une de l'article 'Bétharram : plaintes pour violences au collège' révélant l'affaire publiquement",
                    "title": "Révélation publique de l'affaire",
                    "date": "1996-04-10 12:00:00"
                },
                {
                    "description": "Nouveaux témoignages et révélations sur les violences à Bétharram. François Bayrou ne souhaite pas s'exprimer publiquement tant que l'enquête est en cours",
                    "title": "Nouveaux témoignages - Bayrou ne s'exprime pas",
                    "date": "1996-04-11 12:00:00"
                },
                {
                    "description": "Publication de l'article sur la 'vague de soutien' en faveur de l'institution Notre-Dame de Bétharram aux quatre coins du Sud-Ouest",
                    "title": "Vague de soutien pour Bétharram",
                    "date": "1996-04-12 12:00:00"
                },
                {
                    "description": "Réaction officielle de la direction du collège Notre-Dame de Bétharram aux accusations après plusieurs jours de silence",
                    "title": "Réaction de la direction",
                    "date": "1996-04-13 12:00:00"
                },
                {
                    "description": "Condamnation du surveillant auteur de la gifle à une amende de 5000 francs avec sursis pour violence sur mineur de 15 ans",
                    "title": "Condamnation du surveillant",
                    "date": "1996-06-12 12:00:00"
                },
                {
                    "description": "Mise en examen et incarcération du père Pierre Carricart, ancien directeur de Bétharram, accusé de viol par un ancien élève âgé de 22 ans (10 ans au moment des faits)",
                    "title": "Mise en examen du père Carricart",
                    "date": "1998-05-26 12:00:00"
                },
                {
                    "description": "Publication en Une (second rang après le Grand Prix de Pau) de l'arrestation du père Carricart, avec prudence médiatique",
                    "title": "Publication de l'affaire Carricart",
                    "date": "1998-05-29 12:00:00"
                },
                {
                    "description": "Article sur 'la stupeur' à Bétharram suite à l'affaire Carricart, climat de réserve et prudence imposé par la gravité des accusations",
                    "title": "Stupeur à Bétharram",
                    "date": "1998-05-30 12:00:00"
                },
                {
                    "description": "Dépôt d'une demande de remise en liberté par la défense du père Carricart",
                    "title": "Demande de remise en liberté",
                    "date": "1998-06-06 12:00:00"
                },
                {
                    "description": "Remise en liberté du père Carricart sous contrôle judiciaire par la chambre d'accusation de la cour d'appel de Pau",
                    "title": "Remise en liberté sous contrôle",
                    "date": "1998-06-10 12:00:00"
                },
                {
                    "description": "Confrontation de trois heures dans une atmosphère tendue et parfois houleuse entre le père Carricart et son accusateur chez le juge d'instruction Christian Mirande",
                    "title": "Confrontation judiciaire",
                    "date": "1999-07-06 12:00:00"
                },
                {
                    "description": "Levée partielle du contrôle judiciaire, le père Carricart part à Rome où l'attend le poste d'intendant général de la Congrégation des Pères du Sacré Coeur de Jésus de Bétharram",
                    "title": "Départ pour Rome",
                    "date": "1999-07-15 12:00:00"
                },
                {
                    "description": "Disparition du père Pierre Carricart à Rome, alors qu'il devait être à nouveau mis en examen suite à la plainte d'un ancien interne",
                    "title": "Disparition du père Carricart",
                    "date": "2000-01-14 12:00:00"
                },
                {
                    "description": "Découverte du corps du père Carricart dans les eaux du Tibre à Rome, information 'accrochée' à la Une mais pas en titre principal",
                    "title": "Découverte du corps dans le Tibre",
                    "date": "2000-02-04 12:00:00"
                },
                {
                    "description": "Obsèques du père Carricart célébrées au Calvaire de Bétharram devant une foule très nombreuse selon des témoins",
                    "title": "Obsèques du père Carricart",
                    "date": "2000-02-10 12:00:00"
                },
                {
                    "description": "Publication du courrier d'Alain Esquerre dans la rubrique 'Regards', ancien élève exprimant sa solidarité aux victimes (futur porte-parole du collectif)",
                    "title": "Courrier d'Alain Esquerre",
                    "date": "2000-07-18 12:00:00"
                },
                {
                    "description": "Annonce de l'exhumation possible du corps du père Carricart pour prélèvements ADN suite aux doutes sur la taille mentionnée dans le rapport d'autopsie",
                    "title": "Annonce de l'exhumation",
                    "date": "2000-10-06 12:00:00"
                },
                {
                    "description": "Exhumation du corps du père Carricart à partir de 8h30, accès au lieu interdit par les gendarmes, découverte d'un chapelet dans les mains",
                    "title": "Exhumation du corps",
                    "date": "2000-11-10 08:30:00"
                },
                {
                    "description": "Mise en examen et incarcération d'un religieux octogénaire de Mauléon pour agressions sexuelles et viols sur mineurs (affaire en Une)",
                    "title": "Affaire du religieux de Mauléon",
                    "date": "2000-11-13 12:00:00"
                },
                {
                    "description": "Déclarations de Mgr Pierre Molères, évêque de Bayonne, sur sa ligne de conduite face à la pédophilie : 'On ne peut pas couvrir de tels comportements'",
                    "title": "Position de l'évêque sur la pédophilie",
                    "date": "2000-11-13 12:00:00"
                },
                {
                    "description": "Confirmation par analyses ADN que le corps enterré à Bétharram est bien celui de Pierre Carricart",
                    "title": "Confirmation ADN",
                    "date": "2000-12-02 12:00:00"
                },
                {
                    "description": "Prononcé du non-lieu par le juge Mirande, extinction des poursuites suite au décès confirmé de Pierre Carricart",
                    "title": "Non-lieu prononcé",
                    "date": "2001-03-30 12:00:00"
                }
            ],
            "repuPyreneesPeriods": [
                {
                    "description": "Période de couverture médiatique intensive de l'affaire de la gifle à Bétharram par La République des Pyrénées, de la révélation publique à la condamnation",
                    "title": "Couverture affaire de la gifle",
                    "start": "1996-04-10 12:00:00",
                    "end": "1996-06-12 12:00:00",
                    "color": "#FF5722"
                },
                {
                    "description": "Période de traitement médiatique de l'affaire Carricart par La République des Pyrénées, depuis la mise en examen jusqu'au non-lieu",
                    "title": "Couverture affaire Carricart",
                    "start": "1998-05-26 12:00:00",
                    "end": "2001-03-30 12:00:00",
                    "color": "#9C27B0"
                },
                {
                    "description": "Période d'enquête et procédure judiciaire concernant l'affaire de la gifle, du dépôt de plainte à la condamnation",
                    "title": "Procédure judiciaire - gifle",
                    "start": "1996-01-29 12:00:00",
                    "end": "1996-06-12 12:00:00",
                    "color": "#795548"
                },
                {
                    "description": "Période d'enquête judiciaire sur l'affaire Carricart, de la mise en examen au non-lieu après décès",
                    "title": "Procédure judiciaire - Carricart",
                    "start": "1998-05-26 12:00:00",
                    "end": "2001-03-30 12:00:00",
                    "color": "#607D8B"
                },
                {
                    "description": "Période de liberté sous contrôle judiciaire du père Carricart avant sa fuite à Rome",
                    "title": "Contrôle judiciaire de Carricart",
                    "start": "1998-06-10 12:00:00",
                    "end": "2000-01-14 12:00:00",
                    "color": "#4CAF50"
                },
                {
                    "description": "Période de vérifications post-mortem : de la découverte du corps aux analyses ADN et au non-lieu",
                    "title": "Vérifications post-mortem",
                    "start": "2000-02-04 12:00:00",
                    "end": "2001-03-30 12:00:00",
                    "color": "#607D8B"
                }
            ]
        };

        let currentChart = null;

        // Configuration par défaut du graphique
        const defaultOptions = {
            chart: {
                height: 600,
                type: 'rangeBar',
                toolbar: {
                    show: true,
                    tools: {
                        download: true,
                        selection: true,
                        zoom: true,
                        zoomin: true,
                        zoomout: true,
                        pan: true,
                        reset: true
                    }
                },
                animations: {
                    enabled: true,
                    easing: 'easeinout',
                    speed: 800
                }
            },
            plotOptions: {
                bar: {
                    horizontal: true,
                    barHeight: '50%',
                    rangeBarOverlap: true,
                    rangeBarGroupRows: false
                }
            },
            dataLabels: {
                enabled: true,
                formatter: function(val, opts) {
                    const label = opts.w.globals.labels[opts.dataPointIndex];
                    if (Array.isArray(val)) {
                        // Pour les périodes (range bars)
                        const start = moment(val[0]);
                        const end = moment(val[1]);
                        const duration = moment.duration(end.diff(start));
                        const days = Math.round(duration.asDays());
                        return label + ': ' + days + ' jours';
                    } else {
                        // Pour les événements ponctuels
                        return label;
                    }
                },
                style: {
                    colors: ['#fff'],
                    fontSize: '12px',
                    fontWeight: 'bold'
                }
            },
            xaxis: {
                type: 'datetime',
                labels: {
                    datetimeUTC: false,
                    format: 'yyyy-MM'
                }
            },
            yaxis: {
                show: true,
                labels: {
                    maxWidth: 200
                }
            },
            tooltip: {
                custom: function(opts) {
                    const seriesName = opts.series[opts.seriesIndex][opts.dataPointIndex];
                    const w = opts.ctx.w;
                    let content = '';
                    
                    if (Array.isArray(seriesName)) {
                        // Timeline range
                        const start = moment(seriesName[0]).format('DD/MM/YYYY HH:mm');
                        const end = moment(seriesName[1]).format('DD/MM/YYYY HH:mm');
                        const label = w.globals.labels[opts.dataPointIndex];
                        content = `
                            <div style="padding: 10px;">
                                <strong>${label}</strong><br>
                                Du: ${start}<br>
                                Au: ${end}
                            </div>
                        `;
                    } else {
                        // Event point
                        const date = moment(opts.ctx.w.config.series[opts.seriesIndex].data[opts.dataPointIndex].x).format('DD/MM/YYYY HH:mm');
                        const label = w.globals.labels[opts.dataPointIndex];
                        content = `
                            <div style="padding: 10px;">
                                <strong>${label}</strong><br>
                                Date: ${date}
                            </div>
                        `;
                    }
                    
                    return content;
                }
            },
            legend: {
                position: 'top',
                horizontalAlign: 'left'
            },
            colors: ['#008FFB', '#00E396', '#FEB019', '#FF4560', '#775DD0']
        };

        // Fonction pour convertir les événements en format ApexCharts timeline
        function convertEventsToTimeline(events) {
            return events.map(event => ({
                x: event.title,
                y: moment(event.date).valueOf(),
                description: event.description
            }));
        }

        // Fonction pour convertir les périodes en format ApexCharts rangeBar
        function convertPeriodsToRangeBar(periods) {
            return periods.map(period => ({
                x: period.title,
                y: [
                    moment(period.start).valueOf(),
                    moment(period.end).valueOf()
                ],
                fillColor: period.color,
                description: period.description
            }));
        }

        // Affichage des événements uniquement
        function showEvents() {
            const eventsData = convertEventsToTimeline(timelineData.repuPyreneesEvents);
            
            const options = {
                ...defaultOptions,
                series: [{
                    name: 'Événements',
                    data: eventsData
                }],
                chart: {
                    ...defaultOptions.chart,
                    type: 'scatter'
                },
                plotOptions: {
                    scatter: {
                        radius: 8
                    }
                },
                xaxis: {
                    type: 'datetime',
                    labels: {
                        format: 'yyyy-MM'
                    }
                },
                yaxis: {
                    show: false
                }
            };

            renderChart(options);
        }

        // Affichage des périodes uniquement
        function showPeriods() {
            const periodsData = convertPeriodsToRangeBar(timelineData.repuPyreneesPeriods);
            
            const options = {
                ...defaultOptions,
                series: [{
                    name: 'Périodes',
                    data: periodsData
                }],
                colors: timelineData.repuPyreneesPeriods.map(p => p.color)
            };

            renderChart(options);
        }

        // Affichage combiné
        function showCombined() {
            const periodsData = convertPeriodsToRangeBar(timelineData.repuPyreneesPeriods);
            const eventsData = timelineData.repuPyreneesEvents.map(event => ({
                x: event.title,
                y: [
                    moment(event.date).valueOf(),
                    moment(event.date).add(1, 'day').valueOf()
                ],
                fillColor: '#008FFB',
                description: event.description
            }));
            
            const options = {
                ...defaultOptions,
                series: [
                    {
                        name: 'Périodes',
                        data: periodsData
                    },
                    {
                        name: 'Événements',
                        data: eventsData
                    }
                ],
                chart: {
                    ...defaultOptions.chart,
                    height: 800
                },
                plotOptions: {
                    bar: {
                        horizontal: true,
                        barHeight: '60%',
                        rangeBarGroupRows: true
                    }
                }
            };

            renderChart(options);
        }

        // Fonction de rendu du graphique
        function renderChart(options) {
            if (currentChart) {
                currentChart.destroy();
            }
            
            currentChart = new ApexCharts(document.querySelector("#timeline-chart"), options);
            currentChart.render();
        }

        // Fonctions d'export
        function exportChart() {
            if (currentChart) {
                currentChart.dataURI().then(({imgURI, blob}) => {
                    const link = document.createElement('a');
                    link.href = imgURI;
                    link.download = 'timeline-betharram.png';
                    link.click();
                });
            }
        }

        function exportSVG() {
            if (currentChart) {
                currentChart.dataURI({type: 'svg'}).then(({imgURI, blob}) => {
                    const link = document.createElement('a');
                    link.href = imgURI;
                    link.download = 'timeline-betharram.svg';
                    link.click();
                });
            }
        }

        // Initialisation avec vue combinée
        document.addEventListener('DOMContentLoaded', function() {
            showCombined();
        });
    </script>
</body>
</html>